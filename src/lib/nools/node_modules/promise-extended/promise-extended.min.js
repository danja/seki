/*! promise-extended - v0.0.8 - 2013-06-06
* Copyright (c) 2013 Doug Martin; Licensed MIT */
!function(){"use strict";function a(a,b,c,d,e,f){function g(a,b){return function(){try{k(a.apply(null,arguments)).addCallback(b).addErrback(b)}catch(c){b.errback(c)}}}function h(a,b,c){var d=(new F).callback();return u(a,function(a){d=d.then(c?a:A(null,a)),c||(d=d.then(function(a){return b.push(a),b}))}),d}function i(a){return!v(a)&&x(a.then)}function j(a){var b=new F;return a.then(z(b,"callback"),z(b,"errback")),b.promise()}function k(a){var b;return a=B(arguments),a.length?1===a.length?(a=a.pop(),i(a)?a.addCallback&&a.addErrback?(b=new F,a.addCallback(b.callback),a.addErrback(b.errback)):b=j(a):b=w(a)&&c.every(a,i)?new G(a,!0).promise():(new F).callback(a)):b=new G(c.map(a,function(a){return k(a)}),!0).promise():b=(new F).callback(a).promise(),b}function l(a,b){return function(){var c=new F,d=B(arguments);return d.push(c.resolve),a.apply(b||this,d),c.promise()}}function m(a){if(w(a))return h(a,[],!1);throw new Error("When calling promise.serial the first argument must be an array")}function n(a){if(w(a))return h(a,[],!0);throw new Error("When calling promise.serial the first argument must be an array")}function o(a,b){a=B(arguments);var c=!1;b=a.pop();var d=k(a);return function(){return c?k(b.apply(this,arguments)):(a=arguments,d.then(z(this,function(){return c=!0,b.apply(this,a)})))}}function p(){return new F}function q(a){return new G(a,!0).promise()}function r(a){return p().errback(a)}function s(a){return p().callback(a)}var t,u=c.forEach,v=d.isUndefinedOrNull,w=d.isArray,x=d.isFunction,y=d.isBoolean,z=e.bind,A=e.bindIgnore,B=f.argsToArray;if("function"==typeof setImmediate)t="undefined"!=typeof window?setImmediate.bind(window):setImmediate;else if("undefined"!=typeof process)t=function(a){process.nextTick(a)};else if("undefined"!=typeof MessageChannel){var C=new MessageChannel,D={},E=D;C.port1.onmessage=function(){D=D.next;var a=D.task;delete D.task,a()},t=function(a){E=E.next={task:a},C.port2.postMessage(0)}}else t=function(a){setTimeout(a,0)};var F=a({instance:{__fired:!1,__results:null,__error:null,__errorCbs:null,__cbs:null,constructor:function(){this.__errorCbs=[],this.__cbs=[],e.bindAll(this,["callback","errback","resolve","classic","__resolve","addCallback","addErrback"])},__resolve:function(){if(!this.__fired){this.__fired=!0;var a,b=this.__error?this.__errorCbs:this.__cbs,c=b.length,d=this.__error||this.__results;for(a=0;c>a;a++)this.__callNextTick(b[a],d)}},__callNextTick:function(a,b){t(function(){a.apply(this,b)})},addCallback:function(a){return a&&(i(a)&&a.callback&&(a=a.callback),this.__fired&&this.__results?this.__callNextTick(a,this.__results):this.__cbs.push(a)),this},addErrback:function(a){return a&&(i(a)&&a.errback&&(a=a.errback),this.__fired&&this.__error?this.__callNextTick(a,this.__error):this.__errorCbs.push(a)),this},callback:function(){return this.__fired||(this.__results=arguments,this.__resolve()),this.promise()},errback:function(){return this.__fired||(this.__error=arguments,this.__resolve()),this.promise()},resolve:function(a){return a?this.errback(a):this.callback.apply(this,B(arguments,1)),this},classic:function(a){return"function"==typeof a&&(this.addErrback(function(b){a(b)}),this.addCallback(function(){a.apply(this,[null].concat(B(arguments)))})),this},then:function(a,b){var c=new F,d=c;return x(b)&&(d=g(b,c)),this.addErrback(d),x(a)?this.addCallback(g(a,c)):this.addCallback(c),c.promise()},both:function(a){return this.then(a,a)},promise:function(){var a={then:z(this,"then"),both:z(this,"both"),promise:function(){return a}};return u(["addCallback","addErrback","classic"],function(b){a[b]=z(this,function(){return this[b].apply(this,arguments),a})},this),a}}}),G=F.extend({instance:{__results:null,__errors:null,__promiseLength:0,__defLength:0,__firedLength:0,normalizeResults:!1,constructor:function(a,b){this.__errors=[],this.__results=[],this.normalizeResults=y(b)?b:!1,this._super(arguments),a&&a.length?(this.__defLength=a.length,u(a,this.__addPromise,this)):this.__resolve()},__addPromise:function(a,b){a.then(z(this,function(){var a=B(arguments);a.unshift(b),this.callback.apply(this,a)}),z(this,function(){var a=B(arguments);a.unshift(b),this.errback.apply(this,a)}))},__resolve:function(){if(!this.__fired){this.__fired=!0;var a,b=this.__errors.length?this.__errorCbs:this.__cbs,c=b.length,d=this.__errors.length?this.__errors:this.__results;for(a=0;c>a;a++)this.__callNextTick(b[a],d)}},__callNextTick:function(a,b){t(function(){a.apply(null,[b])})},addCallback:function(a){return a&&(i(a)&&a.callback&&(a=z(a,"callback")),this.__fired&&!this.__errors.length?this.__callNextTick(a,this.__results):this.__cbs.push(a)),this},addErrback:function(a){return a&&(i(a)&&a.errback&&(a=z(a,"errback")),this.__fired&&this.__errors.length?this.__callNextTick(a,this.__errors):this.__errorCbs.push(a)),this},callback:function(a){if(this.__fired)throw new Error("Already fired!");var b=B(arguments);return this.normalizeResults&&(b=b.slice(1),b=1===b.length?b.pop():b),this.__results[a]=b,this.__firedLength++,this.__firedLength===this.__defLength&&this.__resolve(),this.promise()},errback:function(a){if(this.__fired)throw new Error("Already fired!");var b=B(arguments);return this.normalizeResults&&(b=b.slice(1),b=1===b.length?b.pop():b),this.__errors[a]=b,this.__firedLength++,this.__firedLength===this.__defLength&&this.__resolve(),this.promise()}}});return b.define({isPromiseLike:i}).expose({isPromiseLike:i,when:k,wrap:l,wait:o,serial:m,chain:n,Promise:F,PromiseList:G,promise:p,defer:p,deferredList:q,reject:r,resolve:s})}"undefined"!=typeof exports?"undefined"!=typeof module&&module.exports&&(module.exports=a(require("declare.js"),require("extended"),require("array-extended"),require("is-extended"),require("function-extended"),require("arguments-extended"))):"function"==typeof define&&define.amd?define(["declare","extended","array-extended","is-extended","function-extended","arguments-extended"],function(b,c,d,e,f,g){return a(b,c,d,e,f,g)}):this.promiseExtended=a(this.declare,this.extended,this.arrayExtended,this.isExtended,this.functionExtended,this.argumentsExtended)}.call(this);